<script>
    var menuButton = document.getElementById("menu-button");
    var menuCloseButton = document.getElementById("menu-close-button");
    var menuMobile = document.getElementById("menu-mobile");

    var menuOpen = false;

    var openMenu = function (e) {
        if (!menuOpen) {
            menuOpen = true;
            document.body.style.overflowY = "hidden";
            menuButton.classList.add("hidden");
            menuMobile.classList.remove("hidden");
            // animation
            requestAnimationFrame(() => {
                menuMobile.classList.remove("opacity-0", "scale-95");
                menuMobile.classList.add("opacity-100", "scale-100");
            });
            window.onbeforeunload = function (event) {
                closeMenu()
            }
        }
    };

    var closeMenu = function (e) {
        if (menuOpen) {
            menuOpen = false;
            document.body.style.overflowY = "auto";
            menuButton.classList.remove("hidden");

            // animate before hiding
            menuMobile.classList.add("opacity-0", "scale-95");
            menuMobile.classList.remove("opacity-100", "scale-100");

            setTimeout(() => {
                menuMobile.classList.add("hidden");
            }, 300);
            window.onbeforeunload = function (event) {
            }
            e.stopPropagation();
        }
    }

    menuButton.addEventListener("click", openMenu);
    menuCloseButton.addEventListener("click", closeMenu);

</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const dropdownGroups = document.querySelectorAll('.dropdown-group');
        const chevronDown = `<svg class="w-4 h-4 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"></path></svg>`;
        const chevronUp = `<svg class="w-4 h-4 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M11.9999 10.8284L7.0502 15.7782L5.63599 14.364L11.9999 8L18.3639 14.364L16.9497 15.7782L11.9999 10.8284Z"></path></svg>`;

        // Helper: close all dropdowns
        const closeAllDropdowns = () => {
            dropdownGroups.forEach(group => {
                const menu = group.querySelector('.dropdown-menu');
                const chevron = group.querySelector('.dropdown-chevron');
                if (menu) menu.classList.add('hidden');
                if (chevron) chevron.innerHTML = chevronDown;
            });
        };

        dropdownGroups.forEach(group => {
            const button = group.querySelector('.dropdown-btn');
            const menu = group.querySelector('.dropdown-menu');
            const chevron = group.querySelector('.dropdown-chevron');
            const header = document.getElementById('site-header');

            // Toggle dropdown on button click
            button.addEventListener('click', (e) => {
                e.stopPropagation();
                const isVisible = !menu.classList.contains('hidden');
                closeAllDropdowns();
                if (!isVisible) {
                    menu.classList.remove('hidden');
                    if (chevron) chevron.innerHTML = chevronUp;
                }
            });

            // Close when mouse leaves the whole group or the header
            group.addEventListener('mouseleave', (e) => {
                const to = e.relatedTarget;
                if (!group.contains(to) && !(header?.contains(to))) {
                    closeAllDropdowns();
                }
            });
            header.addEventListener('mouseleave', (e) => {
                const to = e.relatedTarget;
                if (!group.contains(to) && !(header?.contains(to))) {
                    closeAllDropdowns();
                }
            });
        });

        // Global click: close if clicked outside any dropdown
        document.addEventListener('click', (e) => {
            if (![...dropdownGroups].some(group => group.contains(e.target))) {
                closeAllDropdowns();
            }
        });
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const header = document.getElementById('site-header');
        const dropdownMenus = document.querySelectorAll('.dropdown-menu');
        const nav = document.getElementById('main-nav');


        const setDropdownWidths = () => {
            const headerRect = header.getBoundingClientRect();
            const navRect = nav.getBoundingClientRect();
            const headerWidth = header.getBoundingClientRect().width;
            const deltaLeft = navRect.left - headerRect.left;

            dropdownMenus.forEach(menu => {
                const dropdownGroup = menu.closest('.dropdown-group');
                const triggerButton = dropdownGroup.querySelector('.dropdown-btn');
                const buttonRect = triggerButton.getBoundingClientRect();

                const offsetFromNav = buttonRect.left - headerRect.left;
                menu.style.left = `${-offsetFromNav}px`;
                menu.style.width = `${headerWidth}px`;
            });
        };

        setDropdownWidths();
        window.addEventListener('resize', setDropdownWidths);
    });
</script>

<script>
    document.querySelectorAll('.accordion-toggle').forEach((toggle) => {
        toggle.addEventListener('click', function () {
            const content = this.nextElementSibling;
            const alreadyOpen = !content.classList.contains('hidden');

            // Close all
            document.querySelectorAll('.accordion-content').forEach((el) => {
                el.classList.add('hidden');
                el.previousElementSibling.querySelector('svg').classList.remove('rotate-180');
            });

            // Toggle current
            if (!alreadyOpen) {
                content.classList.remove('hidden');
                this.querySelector('svg').classList.add('rotate-180');
            }
        });
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const buttons = document.querySelectorAll('.tab-button');
        const panels = document.querySelectorAll('.tab-panel');

        buttons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');

                buttons.forEach(btn => btn.classList.remove('active-tab'));
                panels.forEach(panel => panel.classList.add('hidden'));

                button.classList.add('active-tab');
                document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            });
        });
    });
</script>
