
{{ define "main" }}
    <!-- Navbar placeholder -->
    <section class="section-primary-100">
        <div class="content md:px-12 h-[67px] md:h-[98px] ">
        </div>
    </section>

    <!-- Rocket banner -->
    <section class="section-gradient-primary-1">
        <div class="content flex flex-col">
            {{ $nestorRocket := resources.Get "img/Nestor/nestor-rocket.png" }}
            <div class="w-full flex justify-center items-end">
                <div class=" flex items-end">
                    <img src="{{ $nestorRocket.RelPermalink }}" alt="Discord screenshot" class="w-full h-full max-h-[200px] md:max-h-[400px] xl:max-h-[450px] object-cover object-top rounded-lg" />
                </div>
            </div>
        </div>
    </section>

    <!-- Download Header -->
    <section class="section-light-1 py-12">
        <div class="content px-4">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                <div class="flex flex-col gap-2">
                    <h1 class="text-4xl font-space-grotesk font-medium text-neutral-900">
                        Download Plakar
                    </h1>
                    <p class="text-lg text-neutral-600">
                        Select a version to download binaries for your platform
                    </p>
                </div>

                <div class="flex flex-row gap-4">
                    {{ if .Params.release_notes_url }}
                    <a href="{{ .Params.release_notes_url }}" target="_blank" class="inline-flex items-center gap-2 px-4 py-2 bg-neutral-100 hover:bg-neutral-200 text-neutral-900 rounded-lg transition-colors">
                        <span>Release Notes</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                    </a>
                    {{ end }}

                    {{ if .Params.tests_status_url }}
                    <a href="{{ .Params.tests_status_url }}" target="_blank" class="inline-flex items-center gap-2 px-4 py-2 bg-neutral-100 hover:bg-neutral-200 text-neutral-900 rounded-lg transition-colors">
                        <span>Tests Status</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                    </a>
                    {{ end }}
                </div>
            </div>
        </div>
    </section>

    <!-- Version Selector -->
    <section class="section-light-2 py-8 border-t border-b border-neutral-200">
        <div class="content px-4">
            <div class="flex flex-col gap-4">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-space-grotesk font-medium text-neutral-900">
                        {{ if .Params.version }}
                            Current version: <span class="text-primary-500">{{ .Params.version }}</span>
                        {{ else }}
                            Select a version
                        {{ end }}
                    </h2>

                    <div class="relative" x-data="{ open: false }">
                        <button 
                            @click="open = !open" 
                            class="inline-flex items-center gap-2 px-4 py-2 bg-primary-100 hover:bg-primary-200 text-primary-900 rounded-lg transition-colors"
                        >
                            <span class="hidden md:block">Change version</span>
                            <span class="block md:hidden">Version</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>

                        <div 
                            x-show="open" 
                            @click.away="open = false"
                            x-transition:enter="transition ease-out duration-200"
                            x-transition:enter-start="opacity-0 scale-95"
                            x-transition:enter-end="opacity-100 scale-100"
                            x-transition:leave="transition ease-in duration-150"
                            x-transition:leave-start="opacity-100 scale-100"
                            x-transition:leave-end="opacity-0 scale-95"
                            class="absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10"
                        >
                            <div class="py-1 max-h-96 overflow-y-auto">
                                {{/* 1) Collect version SECTIONS (because you use _index.md in each folder) */}}
                                {{ $raw := where site.Pages "Section" "download" }}
                                {{ $raw = where $raw "Kind" "section" }}
                                {{ $raw = where $raw "Params.version" "!=" nil }}

                                {{/* 2) Build an array of { page, score } using semver parts */}}
                                {{ $packed := slice }}
                                {{ range $raw }}
                                    {{ $v := replace .Params.version "v" "" }}        {{/* strip leading v */}}
                                    {{ $parts := split $v "." }}
                                    {{ $maj := int (index $parts 0) }}
                                    {{ $min := cond (ge (len $parts) 2) (int (index $parts 1)) 0 }}
                                    {{ $pat := cond (ge (len $parts) 3) (int (index $parts 2)) 0 }}
                                    {{ $score := add (mul $maj 1000000) (mul $min 1000) $pat }}
                                    {{ $packed = $packed | append (dict "page" . "score" $score) }}
                                {{ end }}

                                {{/* 3) Sort by score desc and unwrap back to a pages slice */}}
                                {{ $sorted := sort $packed "score" "desc" }}
                                {{ $versions := slice }}
                                {{ range $sorted }}
                                    {{ $versions = $versions | append .page }}
                                {{ end }}

                                {{ range $versions }}
                                <a 
                                    href="{{ .RelPermalink }}" 
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 {{ if eq .Params.version $.Params.version }}bg-primary-50 text-primary-700 font-medium{{ end }}"
                                >
                                    {{ .Params.version }}
                                    {{ if eq .Params.version (index site.Params "latest") }}
                                    <span class="inline-flex items-center rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-800">
                                        Latest
                                    </span>
                                    {{ end }}
                                </a>
                                {{ end }}
                            </div>
                        </div>
                    </div>
                </div>

                {{ if eq .Params.version (index site.Params "latest") }}
                <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-green-800">
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        <span class="font-medium">You are viewing the latest stable version of Plakar.</span>
                    </div>
                </div>
                {{ else }}
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-yellow-800">
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        <span>You are viewing an older version of Plakar. The latest version is <a href="/download/{{ index site.Params "latest" }}" class="underline font-medium">{{ index site.Params "latest" }}</a>.</span>
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
    </section>

    <!-- Download Content -->
    <section class="section-light-1 py-12">
        <div class="content px-4 download-content">
            <div class="prose prose-lg max-w-none">
                {{ .Content }}
            </div>
        </div>
    </section>

    <!-- Documentation link -->
    <section class="section-primary-50 py-12">
        <div class="content px-4">
            <div class="flex flex-col md:flex-row justify-between items-center gap-8 bg-white p-6 rounded-xl">
                <div class="flex flex-col gap-2">
                    <h2 class="text-2xl font-space-grotesk font-medium text-neutral-900">
                        Need help getting started?
                    </h2>
                    <p class="text-neutral-600">
                        Check our documentation for installation guides, usage examples, and more.
                    </p>
                </div>
                <div class="flex flex-col md:flex-row justify-between items-center gap-4 bg-white p-6 rounded-xl">
                {{ partial "cta/get-started-button.html" (dict "label" "Quick start" "labelShort" "Start" "ctx" .) }}
                {{ partial "cta/technical-docs.html" (dict "label" "Documentation" "labelShort" "Docs" "ctx" .) }}

                </div>
            </div>
        </div>
    </section>
{{ end }}
